<div class="reporte-container">
  <div class="header">
    <button class="btn-volver" (click)="volver()">
      <img src="assets/images/volver.png" width="18" />
    </button>
  </div>
  <h2>Pacientes del {{ fechaSeleccionada }}</h2>

  <div *ngFor="let sala of salas" class="sala-container">
    <h3>Sala {{ sala.id }}</h3>
    <div class="tabla-container">
      <table>
        <thead>
          <tr>
            <th>Posición</th>
            <th *ngFor="let hora of horas">{{ hora }}</th>
          </tr>
        </thead>
          <tbody>
            <tr *ngFor="let pos of sala.posiciones">
              <td class="pos">{{ pos }}</td>

              <ng-container *ngFor="let hora of horas; let i = index">
                <ng-container *ngIf="getPacienteBloque(sala.id, pos, hora) as paciente; else libre">
                  <td class="ocupado" [attr.colspan]="calcularColspan(paciente)">
                    <strong>{{ paciente.nombre }}</strong><br>
                    <small>{{ paciente.horaInicio }} - {{ calcularHoraFin(paciente) }}</small>
                  </td>
                  <!-- Saltar las siguientes horas que están dentro del rango -->
                  <ng-container *ngFor="let skip of [].constructor(calcularColspan(paciente) - 1)"></ng-container>
                </ng-container>

                <ng-template #libre>
                  <!-- Mostrar una celda libre solo si no hay paciente activo -->
                  <td class="libre" *ngIf="!isHoraOcupada(sala.id, pos, hora)"></td>
                </ng-template>
              </ng-container>
            </tr>
          </tbody>
      </table>
    </div>
  </div>
</div>

