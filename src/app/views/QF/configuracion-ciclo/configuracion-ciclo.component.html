<div class="container">
  <div class="header">
    <button class="btn-volver" (click)="volver()" >
        <img src="assets/images/volver.png" width="18" style="cursor:pointer;" />
    </button>
  </div>

  <div class="formulario">
    <div class="fila">
        <label>Protocolo:</label>
        <div>{{ protocolo }} <span *ngIf="version">- Versión {{ version }}</span> </div>
    </div>

    <div class="fila">
        <label>Ciclo <span class="requerido">*</span>:</label>
        <div>{{ ciclo }}</div>
    </div>

    <div class="fila">
        <label>Fecha de asignación:</label>
        <div>{{ fecha_asignacion }}</div>
    </div>

    <div class="fila">
        <label>Fecha consulta <span class="requerido">*</span>:</label>
        <input type="date" [(ngModel)]="fecha_consulta" />
    </div>

    <div class="fila">
        <label>Fecha de inicio estimada:</label>
        <input 
            id="fecha_inicio_estimada" 
            type="date" 
            class="form-control" 
            [(ngModel)]="fecha_inicio_estimada"
            required 
        />
    </div>

    <div class="fila">
        <label>Peso <span class="requerido">*</span>:</label>
        <input type="number" [(ngModel)]="peso" />
    </div>

    <div class="fila">
        <label>Superficie corporal <span class="requerido">*</span>:</label>
        <input type="text" [(ngModel)]="superficie" />
    </div>

    <div class="fila">
        <label>TFG:</label>
        <input type="text" [(ngModel)]="tfg" />
    </div>

    <div class="fila">
        <label>Talla: <span class="requerido">*</span></label>
        <input type="text" [(ngModel)]="talla" />
    </div>

    <div class="fila">
        <label>Conciliación medicamentos:</label>
        <input type="checkbox" [(ngModel)]="conf_medicamentos" />
    </div>
  </div>

  <div class="tabla">
    <table class="tabla-eventos">
        <thead>
            <tr>
            <th>Día</th>
            <th>Tipo</th>
            <th>Observación</th>
            <th></th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let evento of eventos; let i = index">
            <td>
                <input type="number" [(ngModel)]="evento.dia" min="0" />
            </td>
            <td>
                <select [(ngModel)]="evento.tipo">
                <option value="">Seleccione</option>
                <option *ngFor="let op of opcionesEvento" [value]="op.value">{{ op.label }}</option>
                </select>
            </td>
            <td>
                <input 
                    type="text" 
                    [(ngModel)]="evento.observacion" 
                    [disabled]="evento.tipo === 'aplicacion'"
                />
            </td>
            <td>
                <button class="btn-trash" (click)="eliminarFila(i)" *ngIf="eventos.length > 1">
                    <img src="assets/images/eliminar.png" width="18" style="cursor:pointer;" />
                </button>
            </td>
            </tr>
        </tbody>
        </table>
        <button class="btn-agregar" (click)="agregarFila()">+</button>
  </div>

  <div class="guardar-fijo">
    <button
      (click)="abrirPopupMedicamentos()"
      [disabled]="!fecha_inicio_estimada"
    >
      Siguiente
    </button>
  </div>

</div>

<app-pop-up-medicamentos
  *ngIf="mostrarPopupMedicamentos"
  [medicamentos]="medicamentos"
  (cerrar)="cerrarPopupMedicamentos()"
  (siguiente)="abrirResumenFinal($event)"
  (guardar)="guardarBorrador($event)"
  >
</app-pop-up-medicamentos>

